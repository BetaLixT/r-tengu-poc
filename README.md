# Prototodo

Task service showcasing clean project structure, event sourcing and CQRS, built
with robustness in mind. Intent of this project is for it to be a sample
project, specifically for Core services within an event driven microservices
environment

## Setting up Generators

This project uses a few generators, this goes over setting up those tools (
required for deveopment and not just to get the project up and running)

### wire

wire is a code generator that sets up dependency injection, to install:

```bash
go install github.com/google/wire/cmd/wire@latest
```

### protoc

protoc is the protocol buffer compiler, follow the latest installation
[instructions](https://grpc.io/docs/protoc-installation/)

### protoc-gen-go

protoc-gen-go is a protoc plugin to generate go code for protocol buffers.
Install with the following command:

```bash
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
```

### protoc-gen-go-grpc

protoc-gen-go-grpc is a plugin to generate go code for grpc servers and clients.
Install with the following command:

```bash
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

### protoc-gen-gocqrshttp

protoc-gen-gocqrshttp is a plugin to generate go code for rest servers from a
protobuf contract, the plugin is opinionated with custom rules, view the
[README](https://dev.azure.com/TechUnicorn/Golang%20Tooling/_git/protoc-gen-gocqrshttp)
for more information, to install:

1. Clone the repository either via HTTPS or SSH, HTTPS will require for
   credentials to be generated for the repository, which can be done
   [here](https://dev.azure.com/TechUnicorn/Golang%20Tooling/_git/protoc-gen-gocqrshttp)
   . SSH method would require for you to register your SSH public key
   [here](https://dev.azure.com/TechUnicorn/_usersSettings/keys)

HTTPS:

```bash
git clone https://TechUnicorn@dev.azure.com/TechUnicorn/Golang%20Tooling/_git/protoc-gen-gocqrshttp
```

SSH:

```bash
git clone git@ssh.dev.azure.com:v3/TechUnicorn/Golang%20Tooling/protoc-gen-gocqrshttp
```

2. Move to cloned repository, and install. This would require for golang and
   make to be installed and correctly setup (make can be installed on windows
   with the `winget install GnuWin32.Make` command and adding the binary to your
   PATH environment variable)

```bash
cd protoc-gen-gocqrshttp
make install
cd ..
```

### hndlrgen

hndlrgen is a minimal code generator that partially generates the handler
functions based off the interfaces generated by protoc-gen-go-grpc, this
generator has been built very specifically for this project and is setup to work
with its structure, the installation steps are very similar to that of
protoc-gen-gocqrshttp

```bash
# Clone either by https or ssh
git clone https://TechUnicorn@dev.azure.com/TechUnicorn/Golang%20Tooling/_git/hndlrgen
# or
git clone git@ssh.dev.azure.com:v3/TechUnicorn/Golang%20Tooling/hndlrgen

## install
cd hndlrgen
make install
cd ..
```

## Dependencies and configuration

The project as is relies on PostgreSQL and Redis, we can run these as docker
containers with the following commands (requires docker to be installed)

```bash
# postgresql
docker run --name postgresql -e POSTGRES_USER=admin -e POSTGRES_PASSWORD=123456 -p 5432:5432 -v /home/dockerdata/psql:/var/lib/postgresql/data --restart unless-stopped -d postgres
# redis
docker run -d -p 6379:6379 --restart unless-stopped --name some-redis redis
```

The project requrires a set of config values either set as environmental
variables or as a file, create the file `cfg/.env` with the following contents,
adjust the passwords if required and fill in the insights instrumentation key.
Ensure that the database has been created

```ini
InsightsInstrumentationKey=
RedisAddress=127.0.0.1:6379
RedisTls=false
DatabaseConnectionString=host=127.0.0.1 port=5432 user=admin password=123456 dbname=tengu sslmode=disable
NodeName=devnode
SnowflakeNodeNumber=0
```

## Running

The project can be launched with the following command

```bash
go run cmd/server/main.go
```

By default the application listens to port 8080 for rest http requests, and
swagger documentation can be accessed at `http://localhost:8080/swagger`

## Glossary (I'm sorry)
